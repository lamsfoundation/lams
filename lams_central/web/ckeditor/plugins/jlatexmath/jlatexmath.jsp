<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><%@ page language="java" pageEncoding="UTF-8" contentType="text/html;charset=utf-8"%><%@ page import="org.lamsfoundation.lams.util.Configuration" %><%@ page import="org.lamsfoundation.lams.util.ConfigurationKeys" %><%@ taglib uri="tags-fmt" prefix="fmt" %><%@ taglib uri="tags-lams" prefix="lams" %><%@ taglib uri="tags-core" prefix="c"%><html><head>	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">	<meta content="noindex, nofollow" name="robots">	<script language="javascript">	var CKEDITOR = window.parent.CKEDITOR;	var thisDialog = CKEDITOR.dialog.getCurrent();	var CK = thisDialog.getParentEditor();	/** Initial setup */	window.onload = function() {		// Translate dialog box		//document.getElementById("MoviePlayerURL").firstChild.data = CK.lang.jlatexmath.MoviePlayerURL;		//document.getElementById("MoviePlayerURLDesc").firstChild.data = CK.lang.jlatexmath.MoviePlayerURLDesc;		//document.getElementById("button-preview").value = CK.lang.jlatexmath.JlatexmathPreview;				// remove our previously registered listeners and reregister a new one		var okButton = thisDialog.getButton('ok');		var newListeners = [];		var oldListeners = okButton._.events.click.listeners;		for (var i = 0; i < okButton._.events.click.listeners.length; i++){			if (okButton._.events.click.listeners[i].priority != 1) {				newListeners.push(okButton._.events.click.listeners[i]);			}		}		okButton._.events.click.listeners = newListeners;		okButton.on('click', triggerOK, null, null, 1);				//		//var formulaTextarea = document.getElementById('latex-formula');		//formulaTextarea.on('change', formulaTextareaChanged, null, null, 1);				// Load selected latex formula		loadLatexFormulaSelection();	}		/** Changing preview image on the fly */	function formulaTextareaChanged(ev) {		if(document.getElementById('latex-formula').value.length == 0) {			return;			}		var latexFormula = document.getElementById('latex-formula').value;				document.getElementById('preview').src = '<lams:LAMSURL/>/servlet/jlatexmath?formula=' + encodeURIComponent(latexFormula);	}	/** Load FCKEditor selection */	function loadLatexFormulaSelection() {		var oSel = CK.getSelection().getSelectedElement();				if (oSel != null) {						var realElementHtml = oSel.getAttribute('_cke_realelement');			if (realElementHtml != 'undefined'){				realElementHtml = decodeURIComponent(realElementHtml);				realElementHtml = realElementHtml.replace(/cke:/g,'');				oSel = CKEDITOR.dom.element.createFromHtml(realElementHtml, thisDialog.document);			}			// Read current settings (existing movie)			document.getElementById('latex-formula').value = oSel.url;		}	}	/** Start processing */	function triggerOK(ev) {		if(document.getElementById('latex-formula').value.length == 0) {			document.getElementById('latex-formula').focus();			// window.parent.SetSelectedTab('Info');			alert(CK.lang.jlatexmath.JlatexmathNoFormula) ;			ev.stop();			return;		}		CK.fire('saveSnapshot', null, CK);				var latexFormula = document.getElementById('latex-formula').value;				// Flash video (FLV)		var resultHtml = '<img src="<lams:LAMSURL/>/servlet/jlatexmath?formula=' + encodeURIComponent(latexFormula) + '" ';		resultHtml    += '        alt="' + latexFormula + '" ';		resultHtml    += '>';		CK.insertHtml(resultHtml);		return true;	}	</script>	</head><body>    <table cellspacing="5" cellpadding="0" width="100%" border="0">	   <tr>		  <td width="100%" colspan="2">		      <span id="MoviePlayerURL">Please, enter latex formula:</span>		  </td>	  </tr>	  	  <tr>          <td style="vertical-align: top; width: 75%">          	<textarea id="latex-formula" style="width: 100%" rows="4" cols="50"           		onkeyup="formulaTextareaChanged(this)"           		onChange="formulaTextareaChanged(this)"          		onpaste="formulaTextareaChanged(this)">          	</textarea>		  </td>	   </tr>	   <tr>	       <td colspan="2">	       	   <img id="preview" src="" alt="">	       </td>	   </tr>	</table></body></html>